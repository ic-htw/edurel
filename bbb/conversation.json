[
  {
    "type": "system",
    "content": "\nYou are an expert SQL query generator. \nConvert natural language questions into valid SQL queries.\nuse postgres syntax.\n"
  },
  {
    "type": "user",
    "content": "\nThe database schema is defined as follows:\ntables:\n- tablename: ccfraud\n  columns:\n  - columnname: userid\n    type: SMALLINT\n  - columnname: card\n    type: SMALLINT\n  - columnname: ts\n    type: TIMESTAMP\n  - columnname: amount\n    type: FLOAT\n  - columnname: use_chip\n    type: VARCHAR\n  - columnname: mname\n    type: BIGINT\n  - columnname: mcity\n    type: VARCHAR\n  - columnname: mstate\n    type: VARCHAR\n  - columnname: zip\n    type: VARCHAR\n  - columnname: mcc\n    type: INTEGER\n  - columnname: err1\n    type: VARCHAR\n  - columnname: err2\n    type: VARCHAR\n  - columnname: err3\n    type: VARCHAR\n  - columnname: is_fraud\n    type: VARCHAR\n\n"
  },
  {
    "type": "ai",
    "content": "the following quer is given\n```sql\nSELECT\n  EXTRACT(YEAR FROM ts)::INT AS year,\n  COUNT(*) AS noof_year,\n  SUM(COUNT(*)) OVER () AS noof_all,\n  COUNT(*)::NUMERIC / SUM(COUNT(*)) OVER () AS frac\nFROM ccfraud\nGROUP BY EXTRACT(YEAR FROM ts)::INT\nORDER BY year;\n```"
  },
  {
    "type": "user",
    "content": "rewrite query format frac\n- output as percent\n- two digits after the decimal point\n- align output\n- use only functions available in duckdb"
  },
  {
    "type": "user",
    "content": "generate rewritten query"
  },
  {
    "type": "ai",
    "content": "```sql\nSELECT\n  EXTRACT(YEAR FROM ts)::INT AS year,\n  COUNT(*) AS noof_year,\n  SUM(COUNT(*)) OVER () AS noof_all,\n  PRINTF('%6.2f%%', (COUNT(*)::NUMERIC / SUM(COUNT(*)) OVER ()) * 100) AS frac\nFROM ccfraud\nGROUP BY EXTRACT(YEAR FROM ts)::INT\nORDER BY year;\n```"
  }
]